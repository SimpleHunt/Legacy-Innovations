generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  email                        String?     @unique
  password                     String?
  fullName                     String?
  phone                        String      @unique
  role                         Role
  isActive                     Boolean     @default(true)
  createdAt                    DateTime    @default(now())
  updatedAt                    DateTime    @updatedAt
  loginUserId                  String?     @unique
  id                           Int         @id @default(autoincrement())
  Customer                     Customer[]
  Franchise                    Franchise[]
  Order_Order_createdByToUser  Order[]     @relation("Order_createdByToUser")
  Order_Order_employeeIdToUser Order[]     @relation("Order_employeeIdToUser")
  Product                      Product[]
}

model enquiry {
  enquiryID  Int      @id @default(autoincrement())
  name       String
  ownerEmail String   @unique
  ownerName  String?
  ownerPhone String   @unique
  address    String?
  status     Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  createdBy  Int?
}

model Franchise {
  name           String
  code           String     @unique
  address        String?
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  isActive       Boolean    @default(true)
  ownerEmail     String     @unique
  ownerName      String?
  ownerPhone     String     @unique
  companyProfile String?
  companyKyc     String?
  bankDetails    String?
  itrDocs        String?
  id             Int        @id @default(autoincrement())
  createdBy      Int?
  Customer       Customer[]
  User           User?      @relation(fields: [createdBy], references: [id])
  Order          Order[]
}

model Customer {
  name         String
  email        String?
  phone        String?
  address      String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  customerType String?
  id           Int        @id @default(autoincrement())
  franchiseId  Int?
  createdBy    Int?
  employeeId   Int?
  customerCode String     @unique
  User         User?      @relation(fields: [employeeId], references: [id])
  Franchise    Franchise? @relation(fields: [franchiseId], references: [id])
  Order        Order[]
}

model Product {
  name        String
  price       Float
  stock       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  size        String
  id          Int      @id @default(autoincrement())
  productCode String   @unique
  createdById Int?
  Order       Order[]
  User        User?    @relation(fields: [createdById], references: [id])
}

model Order {
  orderNumber                 String     @unique
  status                      String     @default("PENDING")
  expectedDeliveryDate        DateTime?
  defectedStatus              Int
  defExpectedDate             DateTime   @default(now())
  unitPrice                   Float      @default(0)
  unitPriceCost               Float      @default(0)
  discountDate                DateTime
  discount                    Float      @default(0)
  gstPercentage               Float      @default(0)
  gstAmount                   Float      @default(0)
  totalAmount                 Float      @default(0)
  createdAt                   DateTime   @default(now())
  updatedAt                   DateTime   @updatedAt
  climate                     Climate
  employeeId                  Int?
  createdBy                   Int?
  productId                   Int
  terrain                     Terrain
  id                          Int        @id @default(autoincrement())
  franchiseId                 Int?
  customerId                  Int?
  Factory                     Factory?
  User_Order_createdByToUser  User?      @relation("Order_createdByToUser", fields: [createdBy], references: [id])
  Customer                    Customer?  @relation(fields: [customerId], references: [id])
  User_Order_employeeIdToUser User?      @relation("Order_employeeIdToUser", fields: [employeeId], references: [id])
  Franchise                   Franchise? @relation(fields: [franchiseId], references: [id])
  Product                     Product    @relation(fields: [productId], references: [id])
  Payment                     Payment[]
}

model Factory {
  id           Int       @id @default(autoincrement())
  orderId      Int       @unique
  orderStatus  String    @default("PROCESSING")
  deliveryDate DateTime?
  createdAt    DateTime  @default(now())
  Order        Order     @relation(fields: [orderId], references: [id])
}

model Payment {
  id        Int      @id @default(autoincrement())
  amount    Float
  orderId   Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  status    String   @default("PENDING")
  method    String
  Order     Order    @relation(fields: [orderId], references: [id])
}

enum Climate {
  HUMID
  COLD
}

enum PaymentMethod {
  CASH
  CARD
  UPI
  BANK_TRANSFER
}

enum Role {
  SUPER_ADMIN
  ADMIN
  FACTORY
  EMPLOYEE
  FRANCHISE
  CUSTOMER
}

enum Terrain {
  FLAT
  HILL_STATION
}
