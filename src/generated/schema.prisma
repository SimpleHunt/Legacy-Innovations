generator client {
  provider = "prisma-client-js"
  output   = "../src/generated"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  email         String?     @unique
  password      String?
  fullName      String?
  phone         String      @unique
  role          Role
  isActive      Boolean     @default(true)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  loginUserId   String?     @unique
  id            Int         @id @default(autoincrement())
  customers     Customer[]
  franchises    Franchise[]
  ordersPlaced  Order[]     @relation("UserOrdersPlaced")
  products      Product[]
  ordersCreated Order[]     @relation("OrderCreatedBy") // <--- ADD THIS
}

model enquiry {
  enquiryID  Int      @id @default(autoincrement())
  name       String
  ownerEmail String   @unique
  ownerName  String?
  ownerPhone String   @unique
  address    String?
  status     Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  createdBy  Int?
}

model Franchise {
  name       String
  code       String   @unique
  address    String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  isActive   Boolean  @default(true)
  ownerEmail String   @unique
  ownerName  String?
  ownerPhone String   @unique

  companyProfile String?
  companyKyc     String?
  bankDetails    String?
  itrDocs        String?

  id        Int        @id @default(autoincrement())
  createdBy Int?
  customers Customer[]
  creator   User?      @relation(fields: [createdBy], references: [id])
  orders    Order[]
}

model Customer {
  name         String
  email        String?
  phone        String?
  address      String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  customerType String?
  id           Int        @id @default(autoincrement())
  cusotmerCode String     @unique
  franchiseId  Int?
  createdBy    Int?
  employeeId   Int?
  employee     User?      @relation(fields: [employeeId], references: [id])
  franchise    Franchise? @relation(fields: [franchiseId], references: [id])
  orders       Order[]
}

model Product {
  name        String
  price       Float
  stock       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  size        String
  id          Int      @id @default(autoincrement())
  productCode String   @unique
  createdById Int?
  orders      Order[]
  createdBy   User?    @relation(fields: [createdById], references: [id])
}

model Order {
  orderNumber          String    @unique
  status               String    @default("PENDING")
  expectedDeliveryDate DateTime?
  defectedStatus       Int
  defExpectedDate      DateTime?
  unitPrice            Float     @default(0)
  unitPriceCost        Float     @default(0)
  discount             Float     @default(0)
  gstPercentage        Float     @default(0)
  gstAmount            Float     @default(0)

  totalAmount Float    @default(0)
  createdAt   DateTime @default(now())

  updatedAt   DateTime   @updatedAt
  climate     Climate
  employeeId  Int?
  createdBy   Int? // <--- field
  productId   Int
  terrain     Terrain
  id          Int        @id @default(autoincrement())
  franchiseId Int?
  customerId  Int?
  factory     Factory?
  customer    Customer?  @relation(fields: [customerId], references: [id])
  employee    User?      @relation("UserOrdersPlaced", fields: [employeeId], references: [id])
  franchise   Franchise? @relation(fields: [franchiseId], references: [id])
  product     Product    @relation(fields: [productId], references: [id])

  // âœ… ADD THIS RELATION
  createdByUser User? @relation("OrderCreatedBy", fields: [createdBy], references: [id])

  payments Payment[]
}

model Factory {
  id           Int       @id @default(autoincrement())
  orderId      Int       @unique
  orderStatus  String    @default("PROCESSING")
  deliveryDate DateTime?
  createdAt    DateTime  @default(now())
  order        Order     @relation(fields: [orderId], references: [id])
}

model Payment {
  id        Int      @id @default(autoincrement())
  amount    Float
  orderId   Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  status    String   @default("PENDING")
  method    String
  order     Order    @relation(fields: [orderId], references: [id])
}

enum Role {
  SUPER_ADMIN
  ADMIN
  FACTORY
  EMPLOYEE
  FRANCHISE
  CUSTOMER
}

enum Climate {
  HUMID
  COLD
}

enum Terrain {
  FLAT
  HILL_STATION
}

enum PaymentMethod {
  CASH
  CARD
  UPI
  BANK_TRANSFER
}
